<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: README.distributed</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">README.distributed </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This document shows how to run the test suite with MPI enabled. The same rules would apply for the tutorials with MPI enabled as well. It first outlines directions for running on the Lanka cluster (good for benchmarking), then gives directions for just running on your local machine (good for development/debugging).</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Running Distributed Tests on the Lanka Cluster</h2>
<p >For tiramisu, we have been testing with OpenMPI, but the scheduler on Lanka, slurm, is built with MVAPICH support, so we need to bypass it. These instructions give all the necessary steps for setting up and running distributed tiramisu with MPI.</p>
<p >Note: Make sure you have installed OpenMPI on lanka somewhere on the /data/scratch filesystem. That way, all of the lanka nodes can see the binaries.</p>
<h4><a class="anchor" id="autotoc_md11"></a>
1. Allocate nodes from Slurm</h4>
<p >You need to have slurm grant you nodes. But you want to do this from within a compute node, not the login node.</p><ul>
<li><p class="startli">Run</p>
<p class="startli"><code>$ srun -N 1 -n 1 --exclusive --pty bash -i</code></p>
<p class="startli">To get into a compute node</p>
</li>
<li><p class="startli">Then run</p>
<p class="startli"><code>$ salloc --exclusive -N &lt;#_Nodes&gt;</code></p>
<p class="startli">To get Slurm to give you exclusive access to #_Nodes. All of the distributed tests use 10 nodes, so if you want to run the MPI tests, get at least 10 nodes. You can see this if you look at the file <code>tests/test_list.txt</code> and look for <code>mpi</code></p>
</li>
<li><p class="startli">Run</p>
<p class="startli"><code>$ squeue</code> To verify that you were granted all the nodes you requested.</p>
</li>
</ul>
<h4><a class="anchor" id="autotoc_md12"></a>
2. Update the configuration.cmake file</h4>
<p ><b>Things like emacs don't work very well on the compute nodes, so you probably want to do this from another tab on the lanka login node</b></p><ul>
<li>Set <code>USE_MPI</code> to <code>TRUE</code>.</li>
<li>Set <code>MPI_BUILD_DIR</code> to the location of the directory you built OpenMPI in. This path will be prepended in CMake to find the bin, include, and lib directories (for example <code>${MPI_BUILD_DIR}/bin</code>)</li>
<li>Set <code>MPI_NODES</code> to be a comma-delimited list of all the lanka nodes that you got from the <code>salloc</code> command. squeue will show you the names.</li>
</ul>
<h4><a class="anchor" id="autotoc_md13"></a>
3. Build and Run tiramisu</h4>
<p ><b>Make sure you compile and run from the same compute node that you ran <code>salloc</code> on!</b> Sometimes slurm seems to complain if you try to run from a different node. <br  />
</p><ul>
<li><p class="startli">Build tiramisu as usual</p>
<p class="startli"><code>$ mkdir build &amp;&amp; cd build</code></p>
<p class="startli"><code>$ cmake ..</code></p>
<p class="startli"><code>$ make tiramisu</code></p>
</li>
<li>Do the normal <code>$ make test</code> to run the full test suite, or just use <code>$ ctest -R &lt;test_#&gt;</code> to run a single test. You should be able to successfully run the MPI tests.</li>
</ul>
<h4><a class="anchor" id="autotoc_md14"></a>
4. Remove allocated nodes</h4>
<ul>
<li><p class="startli">When you are done, free up the nodes that slurm gave you so others can use them. You can always allocate them again :) To do that, run</p>
<p class="startli"><code>$ scancel &lt;job_number&gt;</code></p>
</li>
</ul>
<p >You can get the job number from running <code>squeue</code>.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Running Distributed Tests on your Local Machine</h2>
<p >Most likely, you don't have slurm on your local machine, nor do you have multiple nodes, so the steps are a little different. You still need to have OpenMPI installed on your local machine. Note that performance will likely be terrible, not just because you only have one node, but because OpenMPI doesn't particularly like when you oversubscribe a node (i.e. run more MPI processes than the machine has processors). But since you're not benchmarking on your local machine, and the tests are short, it shouldn't be a problem.</p>
<h4><a class="anchor" id="autotoc_md16"></a>
1. Update the configuration.cmake file</h4>
<p ><b>Things like emacs don't work very well on the compute nodes, so you probably want to do this from another tab on the lanka login node</b></p><ul>
<li>Set <code>USE_MPI</code> to <code>TRUE</code>.</li>
<li>Set <code>MPI_BUILD_DIR</code> to the location of the directory you built OpenMPI in. This path will be prepended in CMake to find the bin, include, and lib directories (for example <code>${MPI_BUILD_DIR}/bin</code>)</li>
<li><p class="startli">Set <code>MPI_NODES</code> to be just be the following:</p>
<p class="startli"><code>set(MPI_NODES "localhost")</code></p>
</li>
</ul>
<h4><a class="anchor" id="autotoc_md17"></a>
2. Build and Run tiramisu</h4>
<ul>
<li><p class="startli">Build tiramisu as usual</p>
<p class="startli"><code>$ mkdir build &amp;&amp; cd build</code></p>
<p class="startli"><code>$ cmake ..</code></p>
<p class="startli"><code>$ make tiramisu</code></p>
</li>
<li>Do the normal <code>$ make test</code> to run the full test suite, or just use <code>$ ctest -R &lt;test_#&gt;</code> to run a single test. You should be able to successfully run the MPI tests. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
